(()=>{const t=document.querySelector("[data-search-input]"),e=document.querySelector("[data-search-results]");if(!t||!e)return;const c=2;let s=[],n=!1,o=!1;const l=t.dataset.searchIndex||"index.json",d=t=>{if(e.innerHTML="",!t.length){e.dataset.visible="false";return}t.slice(0,8).forEach(t=>{const n=document.createElement("a");n.className="sidebar__result",n.href=t.permalink,n.setAttribute("role","option"),n.innerHTML=`<strong>${t.title}</strong><span>${t.description}</span>`,e.appendChild(n)}),e.dataset.visible="true"},i=e=>e.toLowerCase(),a=t=>{const n=i(t.trim());if(n.length<c){e.dataset.visible="false",e.innerHTML="";return}const o=s.filter(e=>{const t=`${e.title} ${e.description} ${e.content}`;return i(t).includes(n)});d(o)},r=async()=>{if(o||n)return;n=!0;try{const e=await fetch(l,{credentials:"same-origin"});if(!e.ok)throw new Error("Failed to fetch search index");s=await e.json(),o=!0}catch(e){console.error(e)}finally{n=!1}};t.addEventListener("input",e=>{r(),a(e.target.value)}),t.addEventListener("focus",()=>{r(),t.value.length&&a(t.value)}),document.addEventListener("click",n=>{if(n.target===t||e.contains(n.target))return;e.dataset.visible="false"})})()